<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Telecom API Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f9f9f9; }
    h1 { color: #333; }
    button { margin: 5px; padding: 10px 15px; border: none; border-radius: 6px; background: #007BFF; color: white; cursor: pointer; }
    button:hover { background: #0056b3; }
    #controls { margin-bottom: 20px; }
    select, input { margin-left: 10px; padding: 5px; }
    canvas { margin-top: 20px; max-width: 800px; }
    #result { margin-top: 20px; white-space: pre-wrap; background: #fff; padding: 15px; border-radius: 6px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
  </style>
</head>
<body>
  <h1>Telecom API Dashboard</h1>

  <div id="controls">
    <button onclick="callApi('/health')">Health</button>
    <button onclick="callApi('/customers?limit=' + getLimit())">Customers</button>
    <button onclick="callApi('/recommend/' + getCustomerId())">Recommend</button>
    <button onclick="callApi('/top_savings?limit=' + getLimit() + addRegion())">Top Savings</button>
    <button onclick="callApi('/top_upsell?limit=' + getLimit() + addRegion())">Top Upsell</button>
    <button onclick="callApi('/summary_stats' + addRegion(true))">Summary Stats</button>

    Limit: <input type="number" id="limit" value="5" min="1" style="width:60px;">
    Customer ID: <input type="number" id="custId" value="1" min="1" style="width:80px;">
    Region:
    <select id="region">
      <option value="">--All--</option>
      <option value="Delhi">Delhi</option>
      <option value="Mumbai">Mumbai</option>
      <option value="Chennai">Chennai</option>
      <option value="Bangalore">Bangalore</option>
      <option value="Hyderabad">Hyderabad</option>
      <option value="Pune">Pune</option>
    </select>
  </div>

  <div id="result">Results will appear here...</div>
  <canvas id="chart"></canvas>

  <script>
    async function callApi(endpoint) {
      document.getElementById("result").innerText = "Loading...";
      let url = endpoint.startsWith("http") ? endpoint : endpoint;
      try {
        let res = await fetch(url);
        let data = await res.json();
        document.getElementById("result").innerText = JSON.stringify(data, null, 2);
        renderChart(endpoint, data);
      } catch (err) {
        document.getElementById("result").innerText = "Error: " + err;
      }
    }

    function getLimit() {
      return document.getElementById("limit").value || 5;
    }
    function getCustomerId() {
      return document.getElementById("custId").value || 1;
    }
    function addRegion(withQuestion = false) {
      let region = document.getElementById("region").value;
      if (!region) return "";
      return withQuestion ? ("?region=" + region) : ("&region=" + region);
    }

    let chart;
    function renderChart(endpoint, data) {
      const ctx = document.getElementById("chart").getContext("2d");
      if (chart) chart.destroy();

      // Customers
      if (endpoint.startsWith("/customers")) {
        let arr = data.customers || [];
        let labels = arr.map(d => d.name || d.customer_id);
        let values = arr.map(d => d.avg_monthly_spend || 0);
        chart = new Chart(ctx, {
          type: 'bar',
          data: { labels, datasets: [{ label: "Monthly Spend", data: values, backgroundColor: 'rgba(75,192,192,0.6)' }] },
          options: { responsive: true, scales: { y: { beginAtZero: true } } }
        });
      }

      // Top Savings / Top Upsell
      else if (endpoint.startsWith("/top_savings") || endpoint.startsWith("/top_upsell")) {
        let arr = Array.isArray(data) ? data : (data.customers || []);
        if (!arr.length) return;
        let labels = arr.map(d => d.name || d.customer_id);
        let values = endpoint.startsWith("/top_savings")
          ? arr.map(d => d.savings || d.avg_monthly_spend || 0)
          : arr.map(d => d.upsell || d.avg_monthly_data_gb || 0);
        chart = new Chart(ctx, {
          type: 'bar',
          data: { labels, datasets: [{ label: endpoint.includes("savings") ? "Savings" : "Upsell", data: values, backgroundColor: 'rgba(54,162,235,0.6)' }] },
          options: { responsive: true, scales: { y: { beginAtZero: true } } }
        });
      }

      // Summary Stats
      else if (endpoint.startsWith("/summary_stats")) {
        let stats = data || {};
        let labels = Object.keys(stats);
        let values = Object.values(stats);
        chart = new Chart(ctx, {
          type: 'pie',
          data: { labels, datasets: [{ data: values, backgroundColor: ['#FF6384','#36A2EB','#FFCE56','#4CAF50','#9C27B0','#FF9800'] }] },
          options: { responsive: true }
        });
      }
    }
  </script>
</body>
</html>
